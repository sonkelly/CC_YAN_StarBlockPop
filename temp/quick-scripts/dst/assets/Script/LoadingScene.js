
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/LoadingScene.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'fa66dpbqYROFqRT9GK3/WP2', 'LoadingScene');
// Script/LoadingScene.js

"use strict";

var GameData = require("GameData");

var GameTools = require("GameTools");

var GameUiTools = require("GameUiTools");

var GameConfig = require("GameConfig");

var AnimLayerTool = require("AnimLayerTool");

cc.Class({
  "extends": cc.Component,
  properties: {},
  start: function start() {
    var _this = this;

    setTimeout(function () {
      _this.loadingResource();
    }, 10);
  },
  loadingResource: function loadingResource() {
    if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneFirst) {
      // GameTools.setGameIntegral(GameTools.getGameIntegral()+1000);
      GameConfig.IS_GAME_MUSIC = GameTools.getItemByLocalStorage("IS_GAME_MUSIC", true);
      this.initFrameCache();
      this.initWxSetting();
    } else if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneEnterGame) {
      GameConfig.IS_GAME_OVER = false;
      GameData.initData();
      GameData.heightScore = GameData.getHeightScore();

      if (GameData.isHaveGameData()) {
        if (GameData.loadGameData(true) || GameData.heightScore < 0 || GameData.heightScore > 1073741824) {
          GameData.setHaveGameData(false);
          GameData.heightScore = 0;
          GameData.setHeightScore(0);
        }
      }
    } else if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneBackGame) {
      if (!GameConfig.IS_GAME_OVER) {
        GameData.loadGameData(false);
      } // GameData.destroyInstance();

    }

    if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneFirst) {
      cc.director.preloadScene("MenuUI", function () {
        cc.director.loadScene("MenuUI");
      });
    } else if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneEnterGame) {
      cc.director.preloadScene("GameScene", function () {
        cc.director.loadScene("GameScene");
      });
    } else if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneBackGame) {
      cc.director.preloadScene("MenuUI", function () {
        cc.director.loadScene("MenuUI");
      });
    }
  },
  initFrameCache: function initFrameCache() {
    cc.loader.loadRes("number", cc.LabelAtlas, function (err, atlas) {
      GameTools.numberLabelAtlas = atlas;
    });
  },
  initWxSetting: function initWxSetting() {
    if (CC_WECHATGAME) {
      window.wx.onHide(function () {
        //监听小游戏隐藏到后台事件
        if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneEnterGame && !GameConfig.IS_GAME_OVER) {
          GameData.loadGameData(false);
          GameTools.stopBackgroundMusic();
        }
      });
      window.wx.onShow(function () {
        if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneEnterGame && !GameConfig.IS_GAME_OVER) {
          if (GameConfig.IS_GAME_MUSIC) {
            GameTools.playBackgroundMusic();
          }
        }
      });
      window.wx.onAudioInterruptionBegin(function () {
        GameTools.stopBackgroundMusic();
      });
      window.wx.onAudioInterruptionEnd(function () {
        //监听音频中断结束
        if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneEnterGame && !GameConfig.IS_GAME_OVER) {
          if (GameConfig.IS_GAME_MUSIC) {
            GameTools.playBackgroundMusic();
          }
        }
      });
      window.wx.showShareMenu({
        withShareTicket: true
      });
      window.wx.onShareAppMessage(function () {
        // 用户点击了“转发”按钮
        return {
          title: '来跟我一起挑战浪漫2048。',
          imageUrl: canvas.toTempFilePathSync({
            destWidth: 500,
            destHeight: 400
          })
        };
      });
      var LaunchOption = wx.getLaunchOptionsSync();

      if (LaunchOption.query != {} && LaunchOption.query.x != undefined) {
        GameConfig.MAIN_MENU_NUM = Number(LaunchOption.query.x);
      }

      var info = window.wx.getSystemInfoSync();
      GameConfig.GameClubButton = window.wx.createGameClubButton({
        icon: 'green',
        style: {
          left: info.windowWidth / 2 + 25,
          top: info.windowHeight * 90 / 100,
          width: 40,
          height: 40
        }
      });
      GameConfig.GameClubButton.hide();
    } else {// GameTools.getRankData("测试群排行");
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxMb2FkaW5nU2NlbmUuanMiXSwibmFtZXMiOlsiR2FtZURhdGEiLCJyZXF1aXJlIiwiR2FtZVRvb2xzIiwiR2FtZVVpVG9vbHMiLCJHYW1lQ29uZmlnIiwiQW5pbUxheWVyVG9vbCIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwic3RhcnQiLCJzZXRUaW1lb3V0IiwibG9hZGluZ1Jlc291cmNlIiwibG9hZGluZ1NjZW5lVHlwZSIsIkxvYWRpbmdTY2VuZVR5cGUiLCJMb2FkaW5nU2NlbmVGaXJzdCIsIklTX0dBTUVfTVVTSUMiLCJnZXRJdGVtQnlMb2NhbFN0b3JhZ2UiLCJpbml0RnJhbWVDYWNoZSIsImluaXRXeFNldHRpbmciLCJMb2FkaW5nU2NlbmVFbnRlckdhbWUiLCJJU19HQU1FX09WRVIiLCJpbml0RGF0YSIsImhlaWdodFNjb3JlIiwiZ2V0SGVpZ2h0U2NvcmUiLCJpc0hhdmVHYW1lRGF0YSIsImxvYWRHYW1lRGF0YSIsInNldEhhdmVHYW1lRGF0YSIsInNldEhlaWdodFNjb3JlIiwiTG9hZGluZ1NjZW5lQmFja0dhbWUiLCJkaXJlY3RvciIsInByZWxvYWRTY2VuZSIsImxvYWRTY2VuZSIsImxvYWRlciIsImxvYWRSZXMiLCJMYWJlbEF0bGFzIiwiZXJyIiwiYXRsYXMiLCJudW1iZXJMYWJlbEF0bGFzIiwiQ0NfV0VDSEFUR0FNRSIsIndpbmRvdyIsInd4Iiwib25IaWRlIiwic3RvcEJhY2tncm91bmRNdXNpYyIsIm9uU2hvdyIsInBsYXlCYWNrZ3JvdW5kTXVzaWMiLCJvbkF1ZGlvSW50ZXJydXB0aW9uQmVnaW4iLCJvbkF1ZGlvSW50ZXJydXB0aW9uRW5kIiwic2hvd1NoYXJlTWVudSIsIndpdGhTaGFyZVRpY2tldCIsIm9uU2hhcmVBcHBNZXNzYWdlIiwidGl0bGUiLCJpbWFnZVVybCIsImNhbnZhcyIsInRvVGVtcEZpbGVQYXRoU3luYyIsImRlc3RXaWR0aCIsImRlc3RIZWlnaHQiLCJMYXVuY2hPcHRpb24iLCJnZXRMYXVuY2hPcHRpb25zU3luYyIsInF1ZXJ5IiwieCIsInVuZGVmaW5lZCIsIk1BSU5fTUVOVV9OVU0iLCJOdW1iZXIiLCJpbmZvIiwiZ2V0U3lzdGVtSW5mb1N5bmMiLCJHYW1lQ2x1YkJ1dHRvbiIsImNyZWF0ZUdhbWVDbHViQnV0dG9uIiwiaWNvbiIsInN0eWxlIiwibGVmdCIsIndpbmRvd1dpZHRoIiwidG9wIiwid2luZG93SGVpZ2h0Iiwid2lkdGgiLCJoZWlnaHQiLCJoaWRlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLFFBQVEsR0FBR0MsT0FBTyxDQUFDLFVBQUQsQ0FBdEI7O0FBQ0EsSUFBSUMsU0FBUyxHQUFHRCxPQUFPLENBQUMsV0FBRCxDQUF2Qjs7QUFDQSxJQUFJRSxXQUFXLEdBQUdGLE9BQU8sQ0FBQyxhQUFELENBQXpCOztBQUNBLElBQUlHLFVBQVUsR0FBR0gsT0FBTyxDQUFDLFlBQUQsQ0FBeEI7O0FBQ0EsSUFBSUksYUFBYSxHQUFHSixPQUFPLENBQUMsZUFBRCxDQUEzQjs7QUFDQUssRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTRCxFQUFFLENBQUNFLFNBRFA7QUFFTEMsRUFBQUEsVUFBVSxFQUFFLEVBRlA7QUFJTEMsRUFBQUEsS0FKSyxtQkFJRztBQUFBOztBQUNKQyxJQUFBQSxVQUFVLENBQUMsWUFBTTtBQUNiLE1BQUEsS0FBSSxDQUFDQyxlQUFMO0FBQ0gsS0FGUyxFQUVQLEVBRk8sQ0FBVjtBQUdILEdBUkk7QUFVTEEsRUFBQUEsZUFWSyw2QkFVYTtBQUNkLFFBQUlSLFVBQVUsQ0FBQ1MsZ0JBQVgsSUFBK0JULFVBQVUsQ0FBQ1UsZ0JBQVgsQ0FBNEJDLGlCQUEvRCxFQUFrRjtBQUM5RTtBQUNBWCxNQUFBQSxVQUFVLENBQUNZLGFBQVgsR0FBMkJkLFNBQVMsQ0FBQ2UscUJBQVYsQ0FBZ0MsZUFBaEMsRUFBaUQsSUFBakQsQ0FBM0I7QUFDQSxXQUFLQyxjQUFMO0FBQ0EsV0FBS0MsYUFBTDtBQUNI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VSxFQUFFO0FBRm9CLFdBQTFCO0FBRlAsU0FBUDtBQU9ILE9BVEQ7QUFVQSxVQUFJQyxZQUFZLEdBQUdoQixFQUFFLENBQUNpQixvQkFBSCxFQUFuQjs7QUFDQSxVQUFJRCxZQUFZLENBQUNFLEtBQWIsSUFBc0IsRUFBdEIsSUFBNEJGLFlBQVksQ0FBQ0UsS0FBYixDQUFtQkMsQ0FBbkIsSUFBd0JDLFNBQXhELEVBQW1FO0FBQy9EekQsUUFBQUEsVUFBVSxDQUFDMEQsYUFBWCxHQUEyQkMsTUFBTSxDQUFDTixZQUFZLENBQUNFLEtBQWIsQ0FBbUJDLENBQXBCLENBQWpDO0FBQ0g7O0FBQ0QsVUFBSUksSUFBSSxHQUFHeEIsTUFBTSxDQUFDQyxFQUFQLENBQVV3QixpQkFBVixFQUFYO0FBQ0E3RCxNQUFBQSxVQUFVLENBQUM4RCxjQUFYLEdBQTRCMUIsTUFBTSxDQUFDQyxFQUFQLENBQVUwQixvQkFBVixDQUErQjtBQUN2REMsUUFBQUEsSUFBSSxFQUFFLE9BRGlEO0FBRXZEQyxRQUFBQSxLQUFLLEVBQUU7QUFDSEMsVUFBQUEsSUFBSSxFQUFFTixJQUFJLENBQUNPLFdBQUwsR0FBbUIsQ0FBbkIsR0FBdUIsRUFEMUI7QUFFSEMsVUFBQUEsR0FBRyxFQUFFUixJQUFJLENBQUNTLFlBQUwsR0FBb0IsRUFBcEIsR0FBeUIsR0FGM0I7QUFHSEMsVUFBQUEsS0FBSyxFQUFFLEVBSEo7QUFJSEMsVUFBQUEsTUFBTSxFQUFFO0FBSkw7QUFGZ0QsT0FBL0IsQ0FBNUI7QUFTQXZFLE1BQUFBLFVBQVUsQ0FBQzhELGNBQVgsQ0FBMEJVLElBQTFCO0FBQ0gsS0FsREQsTUFrRE8sQ0FDSDtBQUNIO0FBQ0o7QUE3R0ksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyIEdhbWVEYXRhID0gcmVxdWlyZShcIkdhbWVEYXRhXCIpO1xudmFyIEdhbWVUb29scyA9IHJlcXVpcmUoXCJHYW1lVG9vbHNcIik7XG52YXIgR2FtZVVpVG9vbHMgPSByZXF1aXJlKFwiR2FtZVVpVG9vbHNcIik7XG52YXIgR2FtZUNvbmZpZyA9IHJlcXVpcmUoXCJHYW1lQ29uZmlnXCIpO1xudmFyIEFuaW1MYXllclRvb2wgPSByZXF1aXJlKFwiQW5pbUxheWVyVG9vbFwiKTtcbmNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG4gICAgcHJvcGVydGllczoge30sXG5cbiAgICBzdGFydCgpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmdSZXNvdXJjZSgpO1xuICAgICAgICB9LCAxMCk7XG4gICAgfSxcblxuICAgIGxvYWRpbmdSZXNvdXJjZSgpIHtcbiAgICAgICAgaWYgKEdhbWVDb25maWcubG9hZGluZ1NjZW5lVHlwZSA9PSBHYW1lQ29uZmlnLkxvYWRpbmdTY2VuZVR5cGUuTG9hZGluZ1NjZW5lRmlyc3QpIHtcbiAgICAgICAgICAgIC8vIEdhbWVUb29scy5zZXRHYW1lSW50ZWdyYWwoR2FtZVRvb2xzLmdldEdhbWVJbnRlZ3JhbCgpKzEwMDApO1xuICAgICAgICAgICAgR2FtZUNvbmZpZy5JU19HQU1FX01VU0lDID0gR2FtZVRvb2xzLmdldEl0ZW1CeUxvY2FsU3RvcmFnZShcIklTX0dBTUVfTVVTSUNcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmluaXRGcmFtZUNhY2hlKCk7XG4gICAgICAgICAgICB0aGlzLmluaXRXeFNldHRpbmcoKTtcbiAgICAgICAgfSBlbHNlIGlmIChHYW1lQ29uZmlnLmxvYWRpbmdTY2VuZVR5cGUgPT0gR2FtZUNvbmZpZy5Mb2FkaW5nU2NlbmVUeXBlLkxvYWRpbmdTY2VuZUVudGVyR2FtZSkge1xuICAgICAgICAgICAgR2FtZUNvbmZpZy5JU19HQU1FX09WRVIgPSBmYWxzZTtcbiAgICAgICAgICAgIEdhbWVEYXRhLmluaXREYXRhKCk7XG4gICAgICAgICAgICBHYW1lRGF0YS5oZWlnaHRTY29yZSA9IEdhbWVEYXRhLmdldEhlaWdodFNjb3JlKCk7XG4gICAgICAgICAgICBpZiAoR2FtZURhdGEuaXNIYXZlR2FtZURhdGEoKSkge1xuICAgICAgICAgICAgICAgIGlmIChHYW1lRGF0YS5sb2FkR2FtZURhdGEodHJ1ZSkgfHwgR2FtZURhdGEuaGVpZ2h0U2NvcmUgPCAwIHx8IEdhbWVEYXRhLmhlaWdodFNjb3JlID4gMTA3Mzc0MTgyNCkge1xuICAgICAgICAgICAgICAgICAgICBHYW1lRGF0YS5zZXRIYXZlR2FtZURhdGEoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBHYW1lRGF0YS5oZWlnaHRTY29yZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIEdhbWVEYXRhLnNldEhlaWdodFNjb3JlKDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChHYW1lQ29uZmlnLmxvYWRpbmdTY2VuZVR5cGUgPT0gR2FtZUNvbmZpZy5Mb2FkaW5nU2NlbmVUeXBlLkxvYWRpbmdTY2VuZUJhY2tHYW1lKSB7XG4gICAgICAgICAgICBpZighR2FtZUNvbmZpZy5JU19HQU1FX09WRVIpe1xuICAgICAgICAgICAgICAgIEdhbWVEYXRhLmxvYWRHYW1lRGF0YShmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBHYW1lRGF0YS5kZXN0cm95SW5zdGFuY2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChHYW1lQ29uZmlnLmxvYWRpbmdTY2VuZVR5cGUgPT0gR2FtZUNvbmZpZy5Mb2FkaW5nU2NlbmVUeXBlLkxvYWRpbmdTY2VuZUZpcnN0KSB7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5wcmVsb2FkU2NlbmUoXCJNZW51VUlcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZShcIk1lbnVVSVwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKEdhbWVDb25maWcubG9hZGluZ1NjZW5lVHlwZSA9PSBHYW1lQ29uZmlnLkxvYWRpbmdTY2VuZVR5cGUuTG9hZGluZ1NjZW5lRW50ZXJHYW1lKSB7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5wcmVsb2FkU2NlbmUoXCJHYW1lU2NlbmVcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZShcIkdhbWVTY2VuZVwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKEdhbWVDb25maWcubG9hZGluZ1NjZW5lVHlwZSA9PSBHYW1lQ29uZmlnLkxvYWRpbmdTY2VuZVR5cGUuTG9hZGluZ1NjZW5lQmFja0dhbWUpIHtcbiAgICAgICAgICAgIGNjLmRpcmVjdG9yLnByZWxvYWRTY2VuZShcIk1lbnVVSVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY2MuZGlyZWN0b3IubG9hZFNjZW5lKFwiTWVudVVJXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGluaXRGcmFtZUNhY2hlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmxvYWRlci5sb2FkUmVzKFwibnVtYmVyXCIsIGNjLkxhYmVsQXRsYXMsIGZ1bmN0aW9uIChlcnIsIGF0bGFzKSB7XG4gICAgICAgICAgICBHYW1lVG9vbHMubnVtYmVyTGFiZWxBdGxhcyA9IGF0bGFzO1xuICAgICAgICB9KTtcbiAgICB9LFxuICAgIGluaXRXeFNldHRpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKENDX1dFQ0hBVEdBTUUpIHtcbiAgICAgICAgICAgIHdpbmRvdy53eC5vbkhpZGUoZnVuY3Rpb24gKCkgey8v55uR5ZCs5bCP5ri45oiP6ZqQ6JeP5Yiw5ZCO5Y+w5LqL5Lu2XG4gICAgICAgICAgICAgICAgaWYgKEdhbWVDb25maWcubG9hZGluZ1NjZW5lVHlwZSA9PSBHYW1lQ29uZmlnLkxvYWRpbmdTY2VuZVR5cGUuTG9hZGluZ1NjZW5lRW50ZXJHYW1lICYmICFHYW1lQ29uZmlnLklTX0dBTUVfT1ZFUikge1xuICAgICAgICAgICAgICAgICAgICBHYW1lRGF0YS5sb2FkR2FtZURhdGEoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBHYW1lVG9vbHMuc3RvcEJhY2tncm91bmRNdXNpYygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgd2luZG93Lnd4Lm9uU2hvdygoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKEdhbWVDb25maWcubG9hZGluZ1NjZW5lVHlwZSA9PSBHYW1lQ29uZmlnLkxvYWRpbmdTY2VuZVR5cGUuTG9hZGluZ1NjZW5lRW50ZXJHYW1lICYmICFHYW1lQ29uZmlnLklTX0dBTUVfT1ZFUikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoR2FtZUNvbmZpZy5JU19HQU1FX01VU0lDKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBHYW1lVG9vbHMucGxheUJhY2tncm91bmRNdXNpYygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB3aW5kb3cud3gub25BdWRpb0ludGVycnVwdGlvbkJlZ2luKCgpID0+IHtcbiAgICAgICAgICAgICAgICBHYW1lVG9vbHMuc3RvcEJhY2tncm91bmRNdXNpYygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB3aW5kb3cud3gub25BdWRpb0ludGVycnVwdGlvbkVuZCgoKSA9PiB7Ly/nm5HlkKzpn7PpopHkuK3mlq3nu5PmnZ9cbiAgICAgICAgICAgICAgICBpZiAoR2FtZUNvbmZpZy5sb2FkaW5nU2NlbmVUeXBlID09IEdhbWVDb25maWcuTG9hZGluZ1NjZW5lVHlwZS5Mb2FkaW5nU2NlbmVFbnRlckdhbWUgJiYgIUdhbWVDb25maWcuSVNfR0FNRV9PVkVSKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChHYW1lQ29uZmlnLklTX0dBTUVfTVVTSUMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEdhbWVUb29scy5wbGF5QmFja2dyb3VuZE11c2ljKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHdpbmRvdy53eC5zaG93U2hhcmVNZW51KHt3aXRoU2hhcmVUaWNrZXQ6IHRydWV9KTtcbiAgICAgICAgICAgIHdpbmRvdy53eC5vblNoYXJlQXBwTWVzc2FnZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8g55So5oi354K55Ye75LqG4oCc6L2s5Y+R4oCd5oyJ6ZKuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfmnaXot5/miJHkuIDotbfmjJHmiJjmtarmvKsyMDQ444CCJyxcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2VVcmw6IGNhbnZhcy50b1RlbXBGaWxlUGF0aFN5bmMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVzdFdpZHRoOiA1MDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXN0SGVpZ2h0OiA0MDBcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxldCBMYXVuY2hPcHRpb24gPSB3eC5nZXRMYXVuY2hPcHRpb25zU3luYygpO1xuICAgICAgICAgICAgaWYgKExhdW5jaE9wdGlvbi5xdWVyeSAhPSB7fSAmJiBMYXVuY2hPcHRpb24ucXVlcnkueCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBHYW1lQ29uZmlnLk1BSU5fTUVOVV9OVU0gPSBOdW1iZXIoTGF1bmNoT3B0aW9uLnF1ZXJ5LngpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGluZm8gPSB3aW5kb3cud3guZ2V0U3lzdGVtSW5mb1N5bmMoKTtcbiAgICAgICAgICAgIEdhbWVDb25maWcuR2FtZUNsdWJCdXR0b24gPSB3aW5kb3cud3guY3JlYXRlR2FtZUNsdWJCdXR0b24oe1xuICAgICAgICAgICAgICAgIGljb246ICdncmVlbicsXG4gICAgICAgICAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogaW5mby53aW5kb3dXaWR0aCAvIDIgKyAyNSxcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBpbmZvLndpbmRvd0hlaWdodCAqIDkwIC8gMTAwLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogNDAsXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIEdhbWVDb25maWcuR2FtZUNsdWJCdXR0b24uaGlkZSgpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBHYW1lVG9vbHMuZ2V0UmFua0RhdGEoXCLmtYvor5XnvqTmjpLooYxcIik7XG4gICAgICAgIH1cbiAgICB9LFxufSk7XG4iXX0=